<% include header.html %>

<div id='scanDisplay' class='science-environmental-graphic'>
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="800px"
         height="600px" viewBox="0 0 800 600" enable-background="new 0 0 800 600" xml:space="preserve">
        <g id="blue">
            <path d="M448.318,165.409l5.068-14.118c0.326,0.118,6.566-18.896,6.566-18.896C440.84,125.364,421.522,122,400,122
                c-31.003,0-60.175,7.975-85.587,21.969L286.7,92.454c0.17-0.093-9.274-17.901-9.274-17.901
                c-21.474,11.669-41.034,26.309-58.799,44.074C170.181,167.073,143.5,231.486,143.5,300c0,68.514,26.681,132.927,75.127,181.373
                S331.486,556.5,400,556.5v-20c-130.407,0-236.5-106.094-236.5-236.5c0-41.524,10.763-80.579,29.637-114.532l50.854,28.908
                c-0.131,0.238,17.125,10.343,17.125,10.343C287.907,175.487,340.116,142,400,142c6.739,0,13.381,0.426,19.9,1.25l-1.54,12.133
                l-2.718,22.616C476.105,185.706,523,237.476,523,300h20C543,238.1,503.463,185.267,448.318,165.409z"
                class="science-environmental-segment-blue"/>
            <path d="M277,300c0-1.95,0.047-3.89,0.138-5.818h-20.013C257.047,296.113,257,298.051,257,300c0,78.851,64.149,143,143,143v-20
                C332.178,423,277,367.822,277,300z"
                class="science-environmental-segment-blue"/>

        </g>
        <g id="meters">
            <path d="M325.962,517.53c0,0-19.179-6.774-25.326-9.616c-5.645-2.609-21.792-11.994-21.792-11.994l40.761-69.105
                c0,0,11.234,6.87,15.193,8.751c3.913,1.859,16.188,6.178,16.188,6.178L325.962,517.53z"
                class="science-environmental-segment"/>
            <path d="M218.623,441.01c0,0-12.579-15.983-16.253-21.672c-3.373-5.225-11.995-21.792-11.995-21.792l71.408-36.578
                c0,0,5.815,11.813,8.154,15.522c2.311,3.663,10.372,13.878,10.372,13.878L218.623,441.01z"
                class="science-environmental-segment"/>
            <path d="M390.605,530.625c0,0-20.305-1.201-26.999-2.231c-6.147-0.945-24.26-5.493-24.26-5.493l20.041-77.688
                c0,0,12.696,3.491,17.021,4.204c4.275,0.704,17.267,1.455,17.267,1.455L390.605,530.625z"
                class="science-environmental-segment"/>
            <path d="M267.738,487.574c0,0-16.536-11.845-21.649-16.285c-4.696-4.077-17.594-17.585-17.594-17.585l58.383-55.032
                c0,0,8.877,9.725,12.157,12.634c3.242,2.875,13.831,10.439,13.831,10.439L267.738,487.574z"
                class="science-environmental-segment"/>
            <path d="M174.128,345.863c0,0-3.398-20.054-3.902-26.807c-0.462-6.202-0.105-24.875-0.105-24.875l80.205,2.047
                c0,0-0.547,13.156-0.268,17.532c0.277,4.323,2.468,17.15,2.468,17.15L174.128,345.863z"
                class="science-environmental-segment"/>
            <path d="M174.563,250.177c0,0,4.699-19.79,6.87-26.203c1.996-5.891,9.612-22.943,9.612-22.943l73.044,33.19
                c0,0-5.638,11.899-7.088,16.037c-1.432,4.087-4.422,16.752-4.422,16.752L174.563,250.177z"
                class="science-environmental-segment"/>
            <path d="M469.751,97.906c-0.787,4.347-4.95,7.233-9.298,6.446l-50.184-9.089c-4.348-0.787-7.233-4.95-6.446-9.297l1.426-7.872
                c0.787-4.347,4.95-7.233,9.298-6.446l50.184,9.089c4.347,0.787,7.233,4.95,6.446,9.297L469.751,97.906z"
                class="science-environmental-segment"/>
            <path d="M538.213,134.496c-2.107,3.884-6.964,5.322-10.848,3.215l-44.823-24.329c-3.883-2.107-5.321-6.965-3.214-10.848
                l3.816-7.031c2.107-3.883,6.964-5.322,10.847-3.215l44.823,24.329c3.883,2.107,5.322,6.965,3.215,10.848L538.213,134.496z"
                class="science-environmental-segment"/>
            <path d="M589.302,197.114c-3.483,2.719-8.51,2.099-11.229-1.384l-31.379-40.203c-2.719-3.482-2.098-8.512,1.385-11.229l6.307-4.923
                c3.482-2.719,8.51-2.099,11.229,1.384l31.379,40.203c2.719,3.482,2.099,8.511-1.384,11.229L589.302,197.114z"
                class="science-environmental-segment"/>
            <path d="M614.431,278.773c-4.264,1.167-8.661-1.346-9.826-5.606l-13.45-49.195c-1.165-4.262,1.349-8.662,5.608-9.827l7.717-2.109
                c4.263-1.166,8.66,1.345,9.825,5.606l13.45,49.195c1.165,4.262-1.348,8.662-5.608,9.827L614.431,278.773z"
                class="science-environmental-segment"/>
            <path d="M517.945,158.943c-2.107,3.884-6.361,5.649-9.502,3.945l-36.246-19.673c-3.141-1.704-3.977-6.235-1.869-10.117l3.816-7.031
                c2.107-3.884,6.361-5.649,9.502-3.945l36.246,19.673c3.14,1.704,3.977,6.234,1.869,10.117L517.945,158.943z"
                class="science-environmental-segment"/>
            <path d="M536.9,223.604c-3.483,2.719-7.695,3.143-9.412,0.946L507.7,199.197c-1.715-2.195-0.279-6.182,3.202-8.898l6.308-4.924
                c3.482-2.719,7.696-3.141,9.41-0.944l19.789,25.353c1.715,2.196,0.28,6.181-3.202,8.899L536.9,223.604z"
                class="science-environmental-segment"/>
            <path d="M557.978,283.432c-4.264,1.166-8.369-0.279-9.175-3.226l-9.3-34.011c-0.805-2.947,2-6.28,6.26-7.445l7.717-2.109
                c4.263-1.166,8.369,0.279,9.174,3.225l9.3,34.011c0.806,2.946-1.999,6.28-6.26,7.445L557.978,283.432z"
                class="science-environmental-segment"/>
        </g>
        <g id="green">
            <path d="M581.373,118.626C532.927,70.18,468.514,43.5,400,43.5c-24.291,0-48.061,3.37-70.792,9.859l5.236,19.393
                c0.057-0.017,0.113-0.035,0.169-0.051l26.386,89.706C301.043,179.424,257,234.665,257,300h20c0-67.822,55.178-123,123-123v-20v-3
                V63.5c130.406,0,236.5,106.094,236.5,236.5h20C656.5,231.486,629.819,167.073,581.373,118.626z"
                class="science-environmental-segment-green"/>
        </g>
    </svg>

    <div id="scanReadout" class='science-environmental-data'>
    </div>

</div>

<script>

var $scanReadout = $("#scanReadout");
var $environmentSegments = $( ".science-environmental-segment" );
var segmentColors = [
    "#60DDF7",
    "#0F8AA6",
    "#03BD11",
    "#83E589",
    "#CCC463"
];
var segmentInterval = 1000;
var updateInterval = 1000;


function moveColors() {

    _.each( $environmentSegments, function( segment ) {

        var color = segmentColors[ Math.floor( Math.random() * segmentColors.length ) ]
        $( segment ).attr( "fill", color );

    } );

}


function updateScan( environmentalData ) {

    $scanReadout.empty();

    var scanTemplate = "<ul class='science-environmental-data'>{{#data}}<li>{{ parameter }}: {{ readout }}</li>{{/data}}</ul>"

    var html = Mustache.render( scanTemplate, { data: environmentalData } )
    console.log( html );
    var $scanData = $( html );

    $scanReadout.append( $scanData );

}


function pollScan() {

    trek.api( 'science/environmental-scan', updateScan );

}


setInterval( moveColors, segmentInterval );
setInterval( pollScan, updateInterval );

// Disable alert screen
trek.onAlert( function() {} );

</script>

<% include footer.html %>